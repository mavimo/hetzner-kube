language: go

sudo: false

cache:
  directories:
    - vendor

go:
#   - 1.9.x
  - 1.10.x
#   - 1.11.x
#   - tip

go_import_path: github.com/xetys/hetzner-kube

before_install:
  - go get -v github.com/golang/dep/cmd/dep
  - dep ensure
  - go get -v github.com/golang/lint/golint
  - go get -u honnef.co/go/tools/...
  - go get -u mvdan.cc/unparam
  - go get -u github.com/client9/misspell/cmd/misspell

after_script:
  - make hard-cleanup

script:
  - golint cmd/ pkg/
  - go test -v ./...
  - unused $(go list ./...)
  - gosimple $(go list ./...)
  - misspell -error $(git ls-files | grep -v vendor/)
  - unparam $(go list ./...)
  - staticcheck $(go list ./...)

jobs:
  include:
    # - stage: E2E testing
    #   script:
    #     - go build
    #     - make preparare
    #     - make test-all
    #     - make cleanup
    #   go: 1.10.x

    - stage: Build
      script:
        - echo "Build binary ..."
        - make build
      go: 1.10.x
      if: tag IS present

    - stage: GitHub Release
      script: echo "Deploying to GitHub releases ..."
      deploy:
        provider: releases
        # NOTE updating the `api_key.secure`
        # - go to: https://github.com/settings/tokens/new
        # - generate new token using `public_repo` scope
        # - encrypt it using: `travis encrypt API_KEY_HERE`
        # - paste the output below
        api_key: "katI8h+sgIxYJLLog5GZG5yHN2VFd8kIOELCmxvBQyaUlkehc5+QkRmcsnZFHs4yu79nqLWt78dBsINtD9kZuKGGBO8GXV+v9diLldqgzVvNCJedXAVf8yWh30Idteeu3+D+Vd8KhNZC2JlguS4b3Dr1eZ6K6YykMLFk+2EEJ83EZByk5M+t6+lLkpB32yihDndsJS/8652Xxn+J8tBDODFr78rEse2fofSmZR5jO8BVxv8l3n2ofJhvk9RMLBZaJeK9isIQvoCLK/V7a1vob+20IKIolmKiKWB1BTrixPrbHo3weBWz2VEAGjwClYRBtlV8ItGcffQcCZ/Vpj9lrQ681FTEHq0Wpdg5hxdypazK8QBFQdYtPrwEuHOoCfMmKY8RMm0ykWshEd+a4m51G1nhZYP1U3TBy3fn45bn/jz/ukMHVGHdkEyToRVwd25hMck/AFfDdsYgv96Q4yiBp2yq/XD+wG1hNyGFC0Fb67QCSZh6YYTomKUed7qZn73+TOuRkBK1UUYznryzv2u+ksPSHTbLsdVtfHfcNDbsKVsiL1uaLCVAtl66CwlINjXC9t0D40Gg/mBqQ9NFa/S5G2zng8iJOyNbX1tV6Qfyufb0TpVrQqoGgitWLwzjsKGQYoa4avgvwIkXeGvIRm4TZQUAVFq8oYEhgqFpGMC9hRE="
        file: dist/*
        file_glob: true
        skip_cleanup: true
        on:
          tags: true
