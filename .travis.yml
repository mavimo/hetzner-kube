language: go

sudo: false

cache:
  directories:
    - vendor

go:
#   - 1.9.x
  - 1.10.x
#   - 1.11.x
#   - tip

go_import_path: github.com/xetys/hetzner-kube

before_install:
  - go get -v github.com/golang/dep/cmd/dep
  - dep ensure
#   - go get -v github.com/golang/lint/golint
#   - go get -u honnef.co/go/tools/...
#   - go get -u mvdan.cc/unparam
#   - go get -u github.com/client9/misspell/cmd/misspell

after_script:
  - make hard-cleanup

script:
#   - golint cmd/ pkg/
  - go test -v ./...
#   - unused $(go list ./...)
#   - gosimple $(go list ./...)
#   - misspell -error $(git ls-files | grep -v vendor/)
#   - unparam $(go list ./...)
#   - staticcheck $(go list ./...)

jobs:
  include:
    # - stage: E2E testing
    #   script:
    #     - go build
    #     - make preparare
    #     - make test-all
    #     - make cleanup
    #   go: 1.10.x

    - stage: Build
      go: 1.10.x
      script:
        - echo "Build binary ..."
        # - make build
        # - ls -la dist/
        # - env
      if: tag IS present

    - stage: GitHub Release
      script:
        - echo "Deploying to GitHub releases ..."
        - make build
      go: 1.10.x
      deploy:
        provider: releases
        # NOTE updating the `api_key.secure`
        # - go to: https://github.com/settings/tokens/new
        # - generate new token using `public_repo` scope
        # - encrypt it using: `travis encrypt API_KEY_HERE`
        # - paste the output below
        api_key: $GITHUB_OAUTH_TOKEN
        file:
         - dist/hetzner-kube-0.3.2-SNAPSHOT-linux-amd64
         - Makefile
        skip_cleanup: true
        on:
          tags: true
